# FreeDays å½“å‰ç”¨æˆ·ç³»ç»Ÿè¯´æ˜

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FreeDays é¡¹ç›®                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  å°ç¨‹åºå‰ç«¯      â”‚         â”‚  åå°ç®¡ç†å‰ç«¯    â”‚        â”‚
â”‚  â”‚  (FreeDays)     â”‚         â”‚  (vite-app)     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â”‚                           â”‚                  â”‚
â”‚           â”‚ å¾®ä¿¡ç™»å½•                   â”‚ ç”¨æˆ·åå¯†ç         â”‚
â”‚           â”‚ wx.login()                â”‚ admin/12345      â”‚
â”‚           â”‚                           â”‚                  â”‚
â”‚           â–¼                           â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚         Next.js API (next-api)               â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  /api/auth/login  â”‚  /api/login             â”‚       â”‚
â”‚  â”‚  (å¾®ä¿¡ç™»å½•)        â”‚  (ç®¡ç†å‘˜ç™»å½•)            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â”‚                           â”‚                  â”‚
â”‚           â–¼                           â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              MongoDB æ•°æ®åº“                   â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  users é›†åˆ                                   â”‚       â”‚
â”‚  â”‚  - å°ç¨‹åºç”¨æˆ·ï¼ˆå¾®ä¿¡ openidï¼‰                   â”‚       â”‚
â”‚  â”‚  - æ²¡æœ‰å¯†ç å­—æ®µ                                â”‚       â”‚
â”‚  â”‚  - æ²¡æœ‰ username å­—æ®µ                         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” å½“å‰ç™»å½•æ–¹å¼

### 1. å°ç¨‹åºç”¨æˆ·ç™»å½•

**æ¥å£**: `POST /api/auth/login`

**æµç¨‹**:
```javascript
// 1. å°ç¨‹åºè°ƒç”¨å¾®ä¿¡ç™»å½•
wx.login() â†’ è·å– code

// 2. å‘é€ code åˆ°åç«¯
POST /api/auth/login
{
  "code": "å¾®ä¿¡è¿”å›çš„ code"
}

// 3. åç«¯å¤„ç†
- è°ƒç”¨å¾®ä¿¡æ¥å£è·å– openid
- æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
- è¿”å› JWT token

// 4. ç”¨æˆ·ä¿¡æ¯
{
  "id": "user_xxx",
  "openid": "wx_openid_xxx",
  "nickname": "ç”¨æˆ·xxx",  // è‡ªåŠ¨ç”Ÿæˆ
  "avatar": "",           // ç©º
  "createdAt": "2024-xx-xx"
}
```

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨é™é»˜ç™»å½•
- âœ… ä¸éœ€è¦ç”¨æˆ·æˆæƒ
- âœ… æ•°æ®å®Œå…¨éš”ç¦»
- âŒ æ²¡æœ‰å¯†ç 
- âŒ ä¸èƒ½ç™»å½•åå°

### 2. åå°ç®¡ç†å‘˜ç™»å½•

**æ¥å£**: `POST /api/login`

**å½“å‰å®ç°**:
```typescript
// ç¡¬ç¼–ç çš„ç®¡ç†å‘˜è´¦å·
if (name === "admin" && password === "12345") {
  return {
    token: "JWT_TOKEN",
    user: {
      userId: "admin_1",
      name: "admin",
      role: ["admin", "super-management"],
      isAdmin: true
    }
  }
}

// ä¹Ÿæ”¯æŒå°ç¨‹åºç”¨æˆ·ç™»å½•ï¼ˆä¸æ¨èï¼‰
if (user && password === "12345") {
  // ä»»ä½•å°ç¨‹åºç”¨æˆ·éƒ½å¯ä»¥ç”¨å¯†ç  12345 ç™»å½•
}
```

**ç‰¹ç‚¹**:
- âš ï¸ ç®¡ç†å‘˜è´¦å·ç¡¬ç¼–ç 
- âš ï¸ å¯†ç æ˜æ–‡æ¯”å¯¹
- âš ï¸ æ‰€æœ‰ç”¨æˆ·å¯†ç éƒ½æ˜¯ 12345
- âš ï¸ å°ç¨‹åºç”¨æˆ·å¯ä»¥ç™»å½•åå°

## ğŸ“‹ æ•°æ®åº“ç»“æ„

### users é›†åˆ

```typescript
{
  id: string;           // ç”¨æˆ·ID
  openid: string;       // å¾®ä¿¡ openid
  nickname: string;     // æ˜µç§°ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
  avatar: string;       // å¤´åƒï¼ˆç©ºï¼‰
  createdAt: Date;      // åˆ›å»ºæ—¶é—´
  updatedAt: Date;      // æ›´æ–°æ—¶é—´
  
  // âŒ æ²¡æœ‰ä»¥ä¸‹å­—æ®µ
  // username?: string;  // åå°ç™»å½•ç”¨æˆ·å
  // password?: string;  // å¯†ç 
  // role?: string[];    // è§’è‰²
  // isAdmin?: boolean;  // æ˜¯å¦ç®¡ç†å‘˜
}
```

### transactions é›†åˆ

```typescript
{
  id: string;
  userId: string;       // å…³è”ç”¨æˆ·ID
  type: 'income' | 'expense';
  amount: number;
  categoryId: string;
  note?: string;
  date: string;
  createdAt: Date;
  updatedAt: Date;
  deletedAt?: Date;
}
```

## ğŸ¯ å½“å‰åŠŸèƒ½

### âœ… å·²å®ç°

1. **å°ç¨‹åºåŠŸèƒ½**
   - å¾®ä¿¡é™é»˜ç™»å½•
   - è®°è´¦åŠŸèƒ½ï¼ˆæ”¶å…¥/æ”¯å‡ºï¼‰
   - æ•°æ®ç»Ÿè®¡
   - æœ¬åœ°å­˜å‚¨ + äº‘ç«¯åŒæ­¥
   - ç”¨æˆ·æ•°æ®å®Œå…¨éš”ç¦»

2. **åå°ç®¡ç†åŠŸèƒ½**
   - ç®¡ç†å‘˜ç™»å½•ï¼ˆadmin/12345ï¼‰
   - æŸ¥çœ‹æ‰€æœ‰å°ç¨‹åºç”¨æˆ·
   - æŸ¥çœ‹ç”¨æˆ·äº¤æ˜“è®°å½•
   - ç”¨æˆ·æ•°æ®ç»Ÿè®¡
   - é‡ç½®ç”¨æˆ·æ•°æ®
   - æ‰¹é‡æ“ä½œ

### âš ï¸ å­˜åœ¨çš„é—®é¢˜

1. **å®‰å…¨é—®é¢˜**
   - ç®¡ç†å‘˜å¯†ç ç¡¬ç¼–ç 
   - å¯†ç æ˜æ–‡å­˜å‚¨å’Œæ¯”å¯¹
   - æ‰€æœ‰ç”¨æˆ·å¯†ç ç›¸åŒï¼ˆ12345ï¼‰

2. **æ¶æ„é—®é¢˜**
   - ä¸¤å¥—ç‹¬ç«‹çš„ç™»å½•ç³»ç»Ÿ
   - ç®¡ç†å‘˜è´¦å·ä¸åœ¨æ•°æ®åº“
   - å°ç¨‹åºç”¨æˆ·å¯ä»¥ç™»å½•åå°

3. **æ‰©å±•æ€§é—®é¢˜**
   - æ— æ³•æ·»åŠ å¤šä¸ªç®¡ç†å‘˜
   - æ— æ³•åŠ¨æ€ä¿®æ”¹æƒé™
   - æ— æ³•ä¸ºç”¨æˆ·è®¾ç½®å¯†ç 

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨é¡¹ç›®

```bash
# 1. å¯åŠ¨åç«¯ API
cd next-api
npm run dev
# è¿è¡Œåœ¨ http://localhost:9527

# 2. å¯åŠ¨åå°ç®¡ç†
cd vite-app
npm run dev
# è¿è¡Œåœ¨ http://localhost:5173
```

### ç™»å½•åå°

```
è®¿é—®: http://localhost:5173
ç”¨æˆ·å: admin
å¯†ç : 12345
```

### æŸ¥çœ‹ç”¨æˆ·

```
ç™»å½•åè®¿é—®: http://localhost:5173/#/accounting/admin
```

## ğŸ“ API åˆ—è¡¨

### å°ç¨‹åº API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| `/api/auth/login` | POST | å¾®ä¿¡ç™»å½• | âŒ |
| `/api/transactions` | GET/POST/PUT/DELETE | äº¤æ˜“è®°å½• | âœ… JWT |
| `/api/categories` | GET | åˆ†ç±»åˆ—è¡¨ | âœ… JWT |
| `/api/statistics/*` | GET | ç»Ÿè®¡æ•°æ® | âœ… JWT |

### åå°ç®¡ç† API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| `/api/login` | POST | ç®¡ç†å‘˜ç™»å½• | âŒ |
| `/api/admin/users-stats` | GET | æ‰€æœ‰ç”¨æˆ·ç»Ÿè®¡ | âœ… JWT (admin) |
| `/api/admin/user-transactions` | GET | ç”¨æˆ·äº¤æ˜“è®°å½• | âœ… JWT (admin) |
| `/api/user/reset-transactions` | POST | é‡ç½®ç”¨æˆ·æ•°æ® | âœ… JWT (admin) |

## ğŸš€ æ”¹è¿›å»ºè®®

### æ–¹æ¡ˆä¸€ï¼šæœ€å°æ”¹åŠ¨ï¼ˆæ¨èï¼‰

**åªä¿®æ”¹åå°ç™»å½•ï¼Œç¦æ­¢å°ç¨‹åºç”¨æˆ·ç™»å½•åå°**

```typescript
// /api/login/route.ts
export async function POST(request: Request) {
  const { name, password } = await request.json();
  
  // åªå…è®¸ç®¡ç†å‘˜
  if (name === "admin" && password === "your_secure_password") {
    return { token, user: { isAdmin: true } };
  }
  
  // æ‹’ç»å…¶ä»–ç™»å½•
  return { code: 401, message: "æ— æƒé™" };
}
```

**ä¼˜ç‚¹**:
- æ”¹åŠ¨æœ€å°
- ç«‹å³ç”Ÿæ•ˆ
- ä¸å½±å“å°ç¨‹åº

**ç¼ºç‚¹**:
- ç®¡ç†å‘˜ä»ç„¶ç¡¬ç¼–ç 
- æ— æ³•æ‰©å±•

### æ–¹æ¡ˆäºŒï¼šå®Œæ•´æ”¹é€ 

**å°†ç®¡ç†å‘˜è´¦å·å­˜å…¥æ•°æ®åº“ï¼Œä½¿ç”¨å¯†ç åŠ å¯†**

1. æ‰©å±• User ç±»å‹
2. æ·»åŠ  usernameã€passwordã€role å­—æ®µ
3. ä½¿ç”¨ bcrypt åŠ å¯†å¯†ç 
4. åˆ›å»ºç®¡ç†å‘˜åˆå§‹åŒ–è„šæœ¬

**ä¼˜ç‚¹**:
- æ›´å®‰å…¨
- å¯æ‰©å±•
- ç¬¦åˆæœ€ä½³å®è·µ

**ç¼ºç‚¹**:
- éœ€è¦æ•°æ®åº“è¿ç§»
- æ”¹åŠ¨è¾ƒå¤§

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å°ç¨‹åºç”¨æˆ·èƒ½ç™»å½•åå°å—ï¼Ÿ

**A**: ç›®å‰å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚å°ç¨‹åºç”¨æˆ·å¯ä»¥ç”¨ nickname æˆ– openid + å¯†ç  12345 ç™»å½•åå°ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°ç®¡ç†å‘˜ï¼Ÿ

**A**: å½“å‰æ— æ³•æ·»åŠ ï¼Œç®¡ç†å‘˜ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ã€‚éœ€è¦å®æ–½æ–¹æ¡ˆäºŒæ‰èƒ½æ”¯æŒã€‚

### Q: å¯†ç å®‰å…¨å—ï¼Ÿ

**A**: ä¸å®‰å…¨ã€‚å¯†ç ç¡¬ç¼–ç ä¸”æ˜æ–‡æ¯”å¯¹ï¼Œå»ºè®®å°½å¿«ä¿®æ”¹ã€‚

### Q: æ•°æ®éš”ç¦»æ­£å¸¸å—ï¼Ÿ

**A**: æ­£å¸¸ã€‚å°ç¨‹åºç”¨æˆ·ä¹‹é—´æ•°æ®å®Œå…¨éš”ç¦»ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®ã€‚

## ğŸ¯ æ€»ç»“

**å½“å‰çŠ¶æ€**:
- âœ… å°ç¨‹åºåŠŸèƒ½å®Œæ•´ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨
- âœ… åå°ç®¡ç†åŠŸèƒ½å®Œæ•´ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
- âš ï¸ å®‰å…¨æ€§è¾ƒä½ï¼Œå¯†ç ç¡¬ç¼–ç 
- âš ï¸ æ‰©å±•æ€§æœ‰é™ï¼Œæ— æ³•æ·»åŠ ç®¡ç†å‘˜

**å»ºè®®**:
1. çŸ­æœŸï¼šä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼Œç¦æ­¢å°ç¨‹åºç”¨æˆ·ç™»å½•åå°
2. é•¿æœŸï¼šå®æ–½å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿæ”¹é€ 

**ä¼˜å…ˆçº§**:
1. ğŸ”´ é«˜ï¼šä¿®æ”¹é»˜è®¤å¯†ç 
2. ğŸŸ¡ ä¸­ï¼šç¦æ­¢å°ç¨‹åºç”¨æˆ·ç™»å½•åå°
3. ğŸŸ¢ ä½ï¼šå®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿæ”¹é€ 
