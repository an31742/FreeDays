<view class="container">
  <!-- æœˆåº¦ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-header">
      <text class="stats-title">{{currentMonth}}æœˆæ”¶æ”¯</text>
      <view class="query-btn" bindtap="toggleQueryPanel">
        <text class="query-icon">ğŸ”</text>
        <text class="query-text">æŸ¥è¯¢</text>
      </view>
    </view>
    <view class="stats-content">
      <view class="stats-item income">
        <text class="stats-label">æ”¶å…¥</text>
        <text class="stats-amount">+{{monthlyStats.income}}</text>
      </view>
      <view class="stats-item expense">
        <text class="stats-label">æ”¯å‡º</text>
        <text class="stats-amount">-{{monthlyStats.expense}}</text>
      </view>
      <view class="stats-item balance">
        <text class="stats-label">ç»“ä½™</text>
        <text class="stats-amount {{monthlyStats.balance >= 0 ? 'positive' : 'negative'}}">
          {{monthlyStats.balance >= 0 ? '+' : ''}}{{monthlyStats.balance}}
        </text>
      </view>
    </view>
  </view>

  <!-- æŸ¥è¯¢é¢æ¿ -->
  <view class="query-panel" hidden="{{!showQueryPanel}}">
    <view class="query-header">
      <text class="query-title">æ—¶é—´æŸ¥è¯¢</text>
    </view>

    <!-- æŸ¥è¯¢æ¨¡å¼é€‰æ‹© -->
    <view class="query-mode-tabs">
      <view class="query-tab {{queryMode === 'day' ? 'active' : ''}}"
            data-mode="day" bindtap="switchQueryMode">
        <text>æ—¥</text>
      </view>
      <view class="query-tab {{queryMode === 'month' ? 'active' : ''}}"
            data-mode="month" bindtap="switchQueryMode">
        <text>æœˆ</text>
      </view>
      <view class="query-tab {{queryMode === 'year' ? 'active' : ''}}"
            data-mode="year" bindtap="switchQueryMode">
        <text>å¹´</text>
      </view>
    </view>

    <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
    <view class="date-picker-section">
      <!-- æ—¥æŸ¥è¯¢ -->
      <view class="picker-item" hidden="{{queryMode !== 'day'}}">
        <text class="picker-label">é€‰æ‹©æ—¥æœŸï¼š</text>
        <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
          <view class="picker-value">{{selectedDate}}</view>
        </picker>
      </view>

      <!-- æœˆæŸ¥è¯¢ -->
      <view class="picker-item" hidden="{{queryMode !== 'month'}}">
        <text class="picker-label">é€‰æ‹©æœˆä»½ï¼š</text>
        <picker mode="date" fields="month" value="{{selectedMonth}}" bindchange="onMonthChange">
          <view class="picker-value">{{selectedMonth}}</view>
        </picker>
      </view>

      <!-- å¹´æŸ¥è¯¢ -->
      <view class="picker-item" hidden="{{queryMode !== 'year'}}">
        <text class="picker-label">é€‰æ‹©å¹´ä»½ï¼š</text>
        <picker mode="date" fields="year" value="{{selectedYear}}" bindchange="onYearChange">
          <view class="picker-value">{{selectedYear}}</view>
        </picker>
      </view>
    </view>

    <!-- æŸ¥è¯¢æŒ‰é’® -->
    <view class="query-actions">
      <button class="query-btn-primary" bindtap="executeQuery">å¼€å§‹æŸ¥è¯¢</button>
      <button class="query-btn-cancel" bindtap="toggleQueryPanel">å–æ¶ˆ</button>
    </view>
  </view>

  <!-- å¿«é€Ÿè®°è´¦ -->
  <view class="quick-add-section">
    <view class="section-header">
      <text class="section-title">å¿«é€Ÿè®°è´¦</text>
    </view>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <view class="tab-bar">
      <view class="tab-item {{activeTab === 0 ? 'active' : ''}}"
            data-index="0" bindtap="switchTab">
        <text>æ”¯å‡º</text>
      </view>
      <view class="tab-item {{activeTab === 1 ? 'active' : ''}}"
            data-index="1" bindtap="switchTab">
        <text>æ”¶å…¥</text>
      </view>
    </view>

    <!-- åˆ†ç±»ç½‘æ ¼ -->
    <view class="categories-grid">
      <!-- æ”¯å‡ºåˆ†ç±» -->
      <view class="category-section" hidden="{{activeTab !== 0}}">
        <view class="category-item"
              wx:for="{{expenseCategories}}"
              wx:key="id"
              data-type="expense"
              data-category-id="{{item.id}}"
              bindtap="quickAdd">
          <view class="category-icon" style="background-color: {{item.color}}">
            <text class="icon-emoji">{{item.icon}}</text>
          </view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>

      <!-- æ”¶å…¥åˆ†ç±» -->
      <view class="category-section" hidden="{{activeTab !== 1}}">
        <view class="category-item"
              wx:for="{{incomeCategories}}"
              wx:key="id"
              data-type="income"
              data-category-id="{{item.id}}"
              bindtap="quickAdd">
          <view class="category-icon" style="background-color: {{item.color}}">
            <text class="icon-emoji">{{item.icon}}</text>
          </view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘äº¤æ˜“ -->
  <view class="recent-section">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘äº¤æ˜“</text>
      <text class="more-btn" bindtap="viewAllTransactions">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>

    <view class="transaction-list">
      <block wx:if="{{recentTransactions.length > 0}}">
        <view class="transaction-item"
              wx:for="{{recentTransactions}}"
              wx:key="id"
              data-id="{{item.id}}"
              bindtap="viewTransaction">
          <view class="transaction-left">
            <view class="transaction-category">
              <text class="category-icon-small"
                    style="background-color: {{item.categoryColor}}">
                {{item.categoryIcon}}
              </text>
              <view class="transaction-info">
                <text class="transaction-title">{{item.displayTitle}}</text>
                <text class="transaction-time">{{item.displayDate}}</text>
              </view>
            </view>
          </view>
          <view class="transaction-right">
            <text class="transaction-amount {{item.type === 'income' ? 'income' : 'expense'}}">
              {{item.type === 'income' ? '+' : '-'}}{{item.amount}}
            </text>
          </view>
        </view>
      </block>

      <view wx:if="{{recentTransactions.length === 0}}" class="empty-state">
        <text class="empty-text">æš‚æ— äº¤æ˜“è®°å½•</text>
        <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹åˆ†ç±»å¼€å§‹è®°è´¦å§</text>
      </view>
    </view>
  </view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="addTransaction">
    <text class="fab-icon">+</text>
  </view>
</view>