# 生产环境API测试指南

## 🌐 当前配置

**API域名**: `https://next-vite-delta.vercel.app/api`
**环境**: 生产环境 (production)

## 📋 测试前准备

### 1. 确认后端状态
访问以下URL确认后端服务正常：
```
https://next-vite-delta.vercel.app/api/health
```

### 2. 检查CORS配置
确保后端已配置允许小程序域名的跨域请求：
```javascript
// 后端需要允许的域名
app.use(cors({
  origin: ['https://servicewechat.com', 'https://developers.weixin.qq.com'],
  credentials: true
}));
```

### 3. 微信小程序域名配置
在微信公众平台配置合法域名：
- 登录 [微信公众平台](https://mp.weixin.qq.com)
- 进入 开发 → 开发设置 → 服务器域名
- 在 `request合法域名` 中添加：`https://next-vite-delta.vercel.app`

## 🧪 测试步骤

### 步骤1: 网络连通性测试
```bash
# 测试域名是否可访问
curl -I https://next-vite-delta.vercel.app/api

# 测试具体接口
curl https://next-vite-delta.vercel.app/api/health
```

### 步骤2: 小程序开发者工具测试
1. 打开微信开发者工具
2. 确保项目配置正确的AppID
3. 在调试器中查看网络请求
4. 测试登录功能
5. 测试记账功能
6. 查看控制台日志

### 步骤3: 真机测试
1. 使用开发者工具预览功能
2. 扫码在真机上测试
3. 检查网络请求是否正常
4. 验证数据同步功能

## 🔍 测试检查点

### API连接测试
- [ ] 能否正常访问API域名
- [ ] 微信登录是否成功
- [ ] Token获取和刷新正常
- [ ] 网络错误处理是否生效

### 功能测试
- [ ] 新增交易记录
- [ ] 编辑交易记录  
- [ ] 删除交易记录
- [ ] 查询统计数据
- [ ] 图表显示正常
- [ ] 离线模式降级

### 数据同步测试
- [ ] 在线操作同步到服务器
- [ ] 离线操作标记待同步
- [ ] 网络恢复后自动同步
- [ ] 多设备数据一致性

## 🚨 常见问题排查

### 1. 网络请求失败
**现象**: 控制台显示网络错误
**排查**:
- 检查域名是否在小程序合法域名列表中
- 确认HTTPS证书有效性
- 检查CORS配置

### 2. 登录失败
**现象**: 无法获取Token
**排查**:
- 检查AppID和AppSecret配置
- 确认微信登录接口正常
- 查看后端日志

### 3. 数据不同步
**现象**: 数据只保存在本地
**排查**:
- 检查网络状态判断逻辑
- 确认API接口返回格式
- 查看同步标记是否正确

## 📊 测试报告模板

### 测试环境
- 小程序版本: 
- 测试设备: 
- 微信版本: 
- 网络环境: 

### 测试结果
| 功能模块 | 测试结果 | 备注 |
|---------|---------|------|
| 用户登录 | ✅/❌ |  |
| 新增记录 | ✅/❌ |  |
| 编辑记录 | ✅/❌ |  |
| 删除记录 | ✅/❌ |  |
| 查询统计 | ✅/❌ |  |
| 图表显示 | ✅/❌ |  |
| 数据同步 | ✅/❌ |  |
| 离线模式 | ✅/❌ |  |

### 性能指标
- API响应时间: 
- 页面加载时间: 
- 数据同步速度: 

## 🔧 调试技巧

### 1. 开启调试模式
在config/api.js中临时开启debug：
```javascript
production: {
  baseURL: 'https://next-vite-delta.vercel.app/api',
  timeout: 10000,
  debug: true  // 临时开启调试
}
```

### 2. 查看网络请求
在微信开发者工具中：
- 打开调试器
- 切换到Network标签
- 观察所有API请求的状态

### 3. 查看控制台日志
留意以下关键日志：
- API请求成功/失败信息
- 数据同步状态
- 错误堆栈信息

## 📞 技术支持

如果测试过程中遇到问题，请提供：
1. 具体错误信息
2. 控制台日志截图
3. 网络请求详情
4. 复现步骤

祝测试顺利！🎉