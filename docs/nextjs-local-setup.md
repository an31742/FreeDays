# ğŸš€ Next.js æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€ç¡®è®¤

âœ… **Next.js 14.0.4** å·²å¯åŠ¨åœ¨ `http://localhost:3000`  
âœ… **ç¯å¢ƒå˜é‡æ–‡ä»¶**: `.env` å·²é…ç½®  
âœ… **å°ç¨‹åºAPIé…ç½®**: å·²æŒ‡å‘æœ¬åœ°ç¯å¢ƒ  

## ğŸ”§ å¾®ä¿¡å¼€å‘è€…å·¥å…·é…ç½®

### å…³é”®æ­¥éª¤ï¼ˆå¿…é¡»å®Œæˆï¼‰

1. **æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·**
2. **ç‚¹å‡»å³ä¸Šè§’"è¯¦æƒ…"æŒ‰é’®**
3. **åˆ‡æ¢åˆ°"æœ¬åœ°è®¾ç½®"æ ‡ç­¾**
4. **å‹¾é€‰ä»¥ä¸‹é€‰é¡¹**ï¼š
   ```
   â˜‘ï¸ ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-view(ä¸šåŠ¡åŸŸå)ã€TLSç‰ˆæœ¬ä»¥åŠHTTPSè¯ä¹¦
   ```
5. **é‡æ–°ç¼–è¯‘é¡¹ç›®**

## ğŸ§ª è¿æ¥æµ‹è¯•

### å¿«é€Ÿæµ‹è¯•ï¼ˆåœ¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°è¿è¡Œï¼‰

```javascript
// æµ‹è¯•åŸºç¡€è¿æ¥
wx.request({
  url: 'http://localhost:3000/api/health',
  success: (res) => {
    console.log('âœ… Next.jsè¿æ¥æˆåŠŸ:', res);
    console.log('ç°åœ¨å¯ä»¥å¼€å§‹å¼€å‘äº†ï¼');
  },
  fail: (err) => {
    console.error('âŒ è¿æ¥å¤±è´¥:', err);
    console.log('è¯·æ£€æŸ¥åŸŸåé…ç½®æˆ–APIè·¯ç”±');
  }
});
```

### å®Œæ•´æµ‹è¯•
å°† `test/nextjs-local-connection.js` æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°æ§åˆ¶å°è¿è¡Œå®Œæ•´æµ‹è¯•ã€‚

## ğŸ“ Next.js API è·¯ç”±ç»“æ„

ç¡®ä¿ä½ çš„Next.jsé¡¹ç›®ä¸­æœ‰ä»¥ä¸‹APIè·¯ç”±ï¼š

```
your-nextjs-project/
â”œâ”€â”€ pages/api/          # Pages Router (Next.js 12åŠä»¥ä¸‹)
â”‚   â”œâ”€â”€ health.js
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ login.js
â”‚   â””â”€â”€ transactions/
â”‚       â””â”€â”€ index.js
â”‚
æˆ–
â”‚
â”œâ”€â”€ app/api/           # App Router (Next.js 13+)
â”‚   â”œâ”€â”€ health/
â”‚   â”‚   â””â”€â”€ route.js
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ login/
â”‚   â”‚       â””â”€â”€ route.js
â”‚   â””â”€â”€ transactions/
â”‚       â””â”€â”€ route.js
```

## ğŸ”‘ ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿ `.env` æˆ– `.env.local` æ–‡ä»¶åŒ…å«ï¼š

```bash
# å¾®ä¿¡å°ç¨‹åºé…ç½®
WECHAT_APP_ID=wx37031fe607647fa3
WECHAT_APP_SECRET=029874ac1aee76391bc7c7f8bcc7f40a

# Next.jsé…ç½®
NEXTAUTH_SECRET=your_nextauth_secret
NEXTAUTH_URL=http://localhost:3000

# æ•°æ®åº“é…ç½®ï¼ˆæ ¹æ®å®é™…æƒ…å†µï¼‰
DATABASE_URL=your_database_connection_string

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key
```

## ğŸŒ CORS é…ç½®ç¤ºä¾‹

åœ¨Next.js APIè·¯ç”±ä¸­é…ç½®CORSï¼š

```javascript
// pages/api/auth/login.js æˆ– app/api/auth/login/route.js
export default function handler(req, res) {
  // è®¾ç½®CORSå¤´
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  
  if (req.method === 'OPTIONS') {
    res.status(200).end();
    return;
  }
  
  // ä½ çš„APIé€»è¾‘
  if (req.method === 'POST') {
    // å¤„ç†ç™»å½•é€»è¾‘
  }
}
```

## ğŸ¯ å¼€å‘å·¥ä½œæµ

### 1. å¯åŠ¨æœåŠ¡
```bash
# Next.jså·²å¯åŠ¨
npm run dev
# æˆ–
yarn dev
```

### 2. å¼€å‘å¾ªç¯
1. **ä¿®æ”¹Next.jsä»£ç ** â†’ è‡ªåŠ¨çƒ­é‡è½½
2. **ä¿®æ”¹å°ç¨‹åºä»£ç ** â†’ è‡ªåŠ¨ç¼–è¯‘
3. **æŸ¥çœ‹æ•ˆæœ** â†’ å®æ—¶é¢„è§ˆ
4. **è°ƒè¯•é—®é¢˜** â†’ æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

### 3. è°ƒè¯•å·¥å…·
- **Next.jsæ§åˆ¶å°**: æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
- **å¾®ä¿¡å¼€å‘è€…å·¥å…·Network**: ç›‘æ§APIè¯·æ±‚
- **å¾®ä¿¡å¼€å‘è€…å·¥å…·Console**: æŸ¥çœ‹å‰ç«¯æ—¥å¿—
- **æµè§ˆå™¨**: è®¿é—® http://localhost:3000 æŸ¥çœ‹Next.jsé¡µé¢

## â— å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: "url not in domain list"
**è§£å†³**: æŒ‰ç…§ä¸Šè¿°æ­¥éª¤é…ç½®å¾®ä¿¡å¼€å‘è€…å·¥å…·åŸŸåè®¾ç½®

### é—®é¢˜2: "404 Not Found"
**åŸå› **: APIè·¯ç”±æœªå®ç°
**è§£å†³**: æ£€æŸ¥Next.jsä¸­çš„APIæ–‡ä»¶ç»“æ„

### é—®é¢˜3: "500 Internal Server Error"  
**åŸå› **: æœåŠ¡å™¨ä»£ç é”™è¯¯
**è§£å†³**: æŸ¥çœ‹Next.jsæ§åˆ¶å°é”™è¯¯æ—¥å¿—

### é—®é¢˜4: "CORSé”™è¯¯"
**åŸå› **: è·¨åŸŸé…ç½®é—®é¢˜
**è§£å†³**: æŒ‰ç…§ä¸Šè¿°CORSé…ç½®ç¤ºä¾‹è®¾ç½®

### é—®é¢˜5: "ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ"
**åŸå› **: ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯
**è§£å†³**: 
- ç¡®è®¤æ–‡ä»¶å `.env.local`
- é‡å¯Next.jsæœåŠ¡å™¨
- æ£€æŸ¥å˜é‡åæ‹¼å†™

## ğŸš€ å¼€å§‹å¼€å‘

ç°åœ¨ä¸€åˆ‡éƒ½é…ç½®å¥½äº†ï¼Œä½ å¯ä»¥ï¼š

1. **æµ‹è¯•å¾®ä¿¡ç™»å½•æµç¨‹**
2. **å®ç°è®°è´¦åŠŸèƒ½çš„å‰åç«¯äº¤äº’**
3. **è°ƒè¯•æ•°æ®å­˜å‚¨å’Œæ£€ç´¢**
4. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**

### å¼€å‘æç¤º

- ğŸ’¡ Next.js APIè·¯ç”±è‡ªåŠ¨å¤„ç†HTTPæ–¹æ³•
- ğŸ’¡ ä½¿ç”¨ `console.log` åœ¨Next.jsæ§åˆ¶å°æŸ¥çœ‹åç«¯æ—¥å¿—
- ğŸ’¡ å°ç¨‹åºè°ƒè¯•ä½¿ç”¨å¼€å‘è€…å·¥å…·Consoleé¢æ¿
- ğŸ’¡ æ•°æ®åº“æ“ä½œå»ºè®®ä½¿ç”¨ORMæˆ–æŸ¥è¯¢æ„å»ºå™¨
- ğŸ’¡ JWT Tokenç®¡ç†è¦æ³¨æ„å®‰å…¨æ€§

---

ğŸ‰ **å¼€å§‹ä½ çš„Next.js + å°ç¨‹åºå¼€å‘ä¹‹æ—…ï¼** ğŸ‰